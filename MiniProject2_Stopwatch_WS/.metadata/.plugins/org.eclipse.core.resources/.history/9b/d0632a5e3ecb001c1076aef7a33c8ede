/*
 * main.c
 *
 *  Created on: May 3, 2022
 *      Author: Ziad Abdallah
 *     Project: MiniProject2_Stopwatch_WS
 *		  File: main file
 */


#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include "stopwatch.h"
#include "timers.h"

ISR(TIMER1_COMPA_vect)
{
	SREG |= (1<<7);
	seconds++;
	if(seconds>59)
	{
		seconds=0;
		minutes++;
		if(minutes>59)
		{
			minutes=0;
			hours++;
			if(hours>12)
			{
				hours=0;
			}
		}
	}
	sec_units_num = seconds%10;
	sec_tens_num = seconds/10;

	min_units_num = minutes%10;
	min_tens_num = minutes/10;

	hour_units_num = hours%10;
	hour_tens_num = hours/10;
}

ISR(INT0_vect)
{
	seconds = 0;
	minutes = 0;
	hours = 0;
//	sec_units_num = 0;
//	sec_tens_num = 0;
//	min_units_num = 0;
//	min_tens_num = 0;
//	hour_units_num = 0;
//	hour_tens_num = 0;
	/* Reinitialize timer counting from zero */
	TCNT1 = 0;
}
int main(void){
	/* Initialization Code */
	SevenSegment_Init();

	Timer1_Init(ONE_SECOND, TRUE);
	TIMER1_START(PRESCALER_64);

	Reset_Button_Init();

	sec_units_num = seconds%10;
	sec_tens_num = seconds/10;

	min_units_num = minutes%10;
	min_tens_num = minutes/10;

	hour_units_num = hours%10;
	hour_tens_num = hours/10;

	while(1)
	{
		/* Application Code */
		SevenSegment_Display(SEC_U, sec_units_num);
		_delay_us(DP_DELAY);
		SevenSegment_Display(SEC_T, sec_tens_num);
		_delay_us(DP_DELAY);

		SevenSegment_Display(MIN_U, min_units_num);
		_delay_us(DP_DELAY);
		SevenSegment_Display(MIN_T, min_tens_num);
		_delay_us(DP_DELAY);

		SevenSegment_Display(HOUR_U, hour_units_num);
		_delay_us(DP_DELAY);
		SevenSegment_Display(HOUR_T, hour_tens_num);
		_delay_us(DP_DELAY);
		
		
	}	

	return 0;
}
